@using Orneholm.SverigesRadio.BlazorSample.Services
@inherits LayoutComponentBase
@inject SharedAudioPlayer SharedAudioPlayer
@implements IDisposable

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">

        <a class="navbar-brand" href="/"><i class="fas fa-headphones-alt"></i> Radiodemo</a>

    </div>
</nav>

<main class="container">
    @if (!string.IsNullOrEmpty(audioUrl))
    {
        <AudioPlayer AudioUrl="@audioUrl" AudioName="@audioName" />
    }
    <div>
        @Body
    </div>
</main>


@code {
    private string audioUrl;
    private string audioName;

    protected override void OnInitialized()
    {
        SharedAudioPlayer.Play += OnPlay;
    }

    public async Task OnPlay(string audioUrl, string audioName)
    {
        await InvokeAsync(() =>
        {
            this.audioUrl = audioUrl;
            this.audioName = audioName;
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        SharedAudioPlayer.Play -= OnPlay;
    }
}
